{"ast":null,"code":"'use strict';\n\nmodule.exports = function () {\n  return {\n    onRequest: function onRequest(evt) {\n      if (evt.adapter !== 'xhr') {\n        return;\n      }\n\n      var xhr = evt.request;\n      var context = evt.context;\n\n      if ('upload' in xhr && 'onprogress' in xhr.upload) {\n        xhr.upload.onprogress = handleProgress('upload');\n      }\n\n      if ('onprogress' in xhr) {\n        xhr.onprogress = handleProgress('download');\n      }\n\n      function handleProgress(stage) {\n        return function (event) {\n          var percent = event.lengthComputable ? event.loaded / event.total * 100 : -1;\n          context.channels.progress.publish({\n            stage: stage,\n            percent: percent,\n            total: event.total,\n            loaded: event.loaded,\n            lengthComputable: event.lengthComputable\n          });\n        };\n      }\n    }\n  };\n};","map":{"version":3,"sources":["../../../src/middleware/progress/browser-progress.js"],"names":["module","onRequest","evt","xhr","context","handleProgress","percent","event","stage","total","loaded","lengthComputable"],"mappings":";;AAAAA,MAAAA,CAAAA,OAAAA,GAAiB,YAAA;AAAA,SAAO;AACtBC,IAAAA,SAAAA,EAAW,SAAA,SAAA,CAAA,GAAA,EAAO;AAChB,UAAIC,GAAAA,CAAAA,OAAAA,KAAJ,KAAA,EAA2B;AACzB;AACD;;AAED,UAAMC,GAAAA,GAAMD,GAAAA,CAAZ,OAAA;AACA,UAAME,OAAAA,GAAUF,GAAAA,CAAhB,OAAA;;AAEA,UAAI,YAAA,GAAA,IAAmB,gBAAgBC,GAAAA,CAAvC,MAAA,EAAmD;AACjDA,QAAAA,GAAAA,CAAAA,MAAAA,CAAAA,UAAAA,GAAwBE,cAAAA,CAAxBF,QAAwBE,CAAxBF;AACD;;AAED,UAAI,gBAAJ,GAAA,EAAyB;AACvBA,QAAAA,GAAAA,CAAAA,UAAAA,GAAiBE,cAAAA,CAAjBF,UAAiBE,CAAjBF;AACD;;AAED,eAAA,cAAA,CAAA,KAAA,EAA+B;AAC7B,eAAO,UAAA,KAAA,EAAS;AACd,cAAMG,OAAAA,GAAUC,KAAAA,CAAAA,gBAAAA,GAA0BA,KAAAA,CAAAA,MAAAA,GAAeA,KAAAA,CAAhB,KAACA,GAA1BA,GAAAA,GAA8D,CAA9E,CAAA;AACAH,UAAAA,OAAAA,CAAAA,QAAAA,CAAAA,QAAAA,CAAAA,OAAAA,CAAkC;AAChCI,YAAAA,KAAAA,EADgC,KAAA;AAEhCF,YAAAA,OAAAA,EAFgC,OAAA;AAGhCG,YAAAA,KAAAA,EAAOF,KAAAA,CAHyB,KAAA;AAIhCG,YAAAA,MAAAA,EAAQH,KAAAA,CAJwB,MAAA;AAKhCI,YAAAA,gBAAAA,EAAkBJ,KAAAA,CAAMI;AALQ,WAAlCP;AAFF,SAAA;AAUD;AACF;AA7BqB,GAAP;AAAjBJ,CAAAA","sourcesContent":["module.exports = () => ({\n  onRequest: evt => {\n    if (evt.adapter !== 'xhr') {\n      return\n    }\n\n    const xhr = evt.request\n    const context = evt.context\n\n    if ('upload' in xhr && 'onprogress' in xhr.upload) {\n      xhr.upload.onprogress = handleProgress('upload')\n    }\n\n    if ('onprogress' in xhr) {\n      xhr.onprogress = handleProgress('download')\n    }\n\n    function handleProgress(stage) {\n      return event => {\n        const percent = event.lengthComputable ? (event.loaded / event.total) * 100 : -1\n        context.channels.progress.publish({\n          stage,\n          percent,\n          total: event.total,\n          loaded: event.loaded,\n          lengthComputable: event.lengthComputable\n        })\n      }\n    }\n  }\n})\n"]},"metadata":{},"sourceType":"script"}